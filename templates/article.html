{% extends "base.html" %}

{% block content %}
<article itemscope itemtype="https://schema.org/Article">
    <header>
        <h1 itemprop="headline">{{ title }}</h1>
        {% if date %}
        <p>
            <time datetime="{{ date }}" itemprop="datePublished">{{ date_formatted }}</time>
            {% if tags %}
            <span aria-label="Tags">
                {% for tag in tags %}
                <a href="/tags/{{ tag }}/" rel="tag">#{{ tag }}</a>{% if not loop.last %}, {% endif %}
                {% endfor %}
            </span>
            {% endif %}
        </p>
        {% endif %}
    </header>
    
    <div itemprop="articleBody" class="markdown-body">
        {{ content | safe }}
    </div>
    
    {% if related %}
    <aside aria-label="Related articles">
        <h2>Related Posts</h2>
        <ul>
            {% for post in related %}
            <li><a href="{{ post.url }}">{{ post.title }}</a></li>
            {% endfor %}
        </ul>
    </aside>
    {% endif %}
</article>

<section id="comments" aria-label="Comments">
    <h2>Comments ({{ comments|length }})</h2>
    
    {% if comments %}
    <ol class="comment-list">
        {% for comment in comments %}
        <li id="comment-{{ comment.id }}" class="comment">
            <div class="comment-meta">
                <strong>{{ comment.author.name }}</strong>
                <time datetime="{{ comment.date }}">{{ comment.date_formatted }}</time>
            </div>
            <div class="comment-content markdown-body">
                {{ comment.content | safe }}
            </div>
        </li>
        {% endfor %}
    </ol>
    {% endif %}
    
    <form 
        method="POST" 
        action="{{ comments_webhook_url }}" 
        id="comment-form"
        class="comment-form"
    >
        <h3>Leave a Comment</h3>
        
        <input type="hidden" name="page_slug" value="{{ slug }}">
        <input type="hidden" name="page_type" value="{{ page_type }}">
        <input type="hidden" name="page_url" value="{{ canonical_url }}">
        
        <label for="author-name">Name <abbr title="required">*</abbr></label>
        <input 
            type="text" 
            id="author-name" 
            name="author_name" 
            required 
            autocomplete="name"
            maxlength="100"
        >
        
        <label for="author-email">Email <abbr title="required">*</abbr></label>
        <input 
            type="email" 
            id="author-email" 
            name="author_email" 
            required 
            autocomplete="email"
            aria-describedby="email-privacy"
        >
        <small id="email-privacy">Never published or shared. Used only for Gravatar.</small>
        
        <label for="author-website">Website <span>(optional)</span></label>
        <input 
            type="url" 
            id="author-website" 
            name="author_website" 
            autocomplete="url"
        >
        
        <label for="comment-content">Comment <abbr title="required">*</abbr></label>
        <textarea 
            id="comment-content" 
            name="comment_content" 
            required 
            rows="6"
            maxlength="2000"
            aria-describedby="comment-help"
        ></textarea>
        <small id="comment-help">Markdown supported. Max 2000 characters.</small>
        
        <!-- Honeypot for spam prevention -->
        <input type="text" name="website" style="display:none" tabindex="-1" autocomplete="off">
        
        <button type="submit">Submit Comment</button>
        <p class="form-status" aria-live="polite"></p>
    </form>
</section>
{% endblock %}

