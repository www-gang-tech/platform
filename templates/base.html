<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; img-src 'self' https: data:; font-src 'self' https://cdnjs.cloudflare.com; connect-src 'self' http://localhost:8000 http://localhost:5001; base-uri 'self'; form-action 'self' https: https://*.n8n.app https://*.n8n.io;">
    <title>{{ title }} - {{ site_title }}</title>
    <meta name="description" content="{{ description }}">
    {% if canonical_url %}<link rel="canonical" href="{{ canonical_url }}">{% endif %}
    
    <!-- JSON-LD Structured Data -->
    {% if jsonld %}
    <script type="application/ld+json">
    {{ jsonld | tojson }}
    </script>
    {% endif %}
    
    <!-- Resource Hints -->
    <link rel="preload" href="/assets/style.css" as="style">
    
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    {% if user_authenticated %}
    <!-- Editor resources (only for authenticated users) -->
    <link rel="preload" href="/assets/editor.css" as="style">
    <link rel="stylesheet" href="/assets/editor.css">
    {% endif %}
</head>
<body data-page-type="{{ page_type|default('page') }}" data-category="{{ category|default('') }}" data-slug="{{ slug|default('') }}">
    {% include "partials/header.html" %}
    
    <main role="main" id="content">
        {% block content %}{% endblock %}
    </main>
    
    {% include "partials/footer.html" %}

    {% if user_authenticated %}
    <!-- In-Place Editor (only for authenticated users) -->
            <button id="edit-trigger" class="edit-btn" onclick="activateEditor()" aria-label="Edit this page">
                <i class="fa-solid fa-pen"></i> Edit
            </button>
    <script src="/assets/editor-bundle.js" defer></script>
    {% endif %}
    
    <!-- Comments System (progressive enhancement) -->
    <script src="/assets/comments.js" defer></script>
</body>
</html>
